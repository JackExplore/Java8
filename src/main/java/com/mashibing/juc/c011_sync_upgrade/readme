synchronized的底层实现

JDK 早期的 重量级 - OS

后来的改进：
    锁升级的概念（厕所所长的故事1、2）

sync(obj)
    第一个线程, markword 记录这个线程 ID, 【偏向锁】;
    如果有线程争用，升级为，【自旋锁】，默认旋10次，占用CPU资源，但是不访问OS，是在用户态;
    如果10次以后，还得不到这把锁，升级为【重量级锁】，去操作系统申请 OS;


适用场景
    执行时间短（加锁代码），线程数少，用自旋锁；
    执行时间长，线程数多，用系统锁；

注意事项
    synchronized(object)
        不能使用 String 常量 Integer Long
        不要用基本数据类型

小结
    synchronized 锁的是对象，而不是代码
    this    XX.class
    锁定方法和非锁定方法 同时执行
